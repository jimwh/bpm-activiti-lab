<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:activiti="http://activiti.org/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://www.activiti.org/R_R_S">

    <signal id="terminate" name="Terminate Process" activiti:scope="processInstance"/>
    <signal id="terminate2" name="Terminate2 Process" activiti:scope="processInstance"/>

    <process id="R_R_S" isExecutable="true" name="Return-Review-Activate-Deactivate Process with signal">

        <extensionElements>
            <activiti:executionListener event="start" delegateExpression="${actListener}"/>
        </extensionElements>

        <startEvent id="theStart" name="StartEvent"/>
        <endEvent id="theEnd" name="EndEvent"/>

        <userTask id="submit" name="Submit">
            <extensionElements>
                <activiti:taskListener event="complete" delegateExpression="${actListener}"/>
            </extensionElements>
        </userTask>

        <userTask id="return" name="Return">
            <extensionElements>
                <activiti:taskListener event="complete" delegateExpression="${actListener}"/>
            </extensionElements>
        </userTask>
        <boundaryEvent id="boundary" name="returnBoundary" attachedToRef="return" cancelActivity="true">
            <signalEventDefinition signalRef="terminate"/>
        </boundaryEvent>

        <userTask id="approve" name="Approve">
            <extensionElements>
                <activiti:taskListener event="complete" delegateExpression="${actListener}"/>
            </extensionElements>
        </userTask>
        <boundaryEvent id="boundaryApprove" name="approveBoundary" attachedToRef="approve" cancelActivity="true">
            <signalEventDefinition signalRef="terminate2"/>
        </boundaryEvent>

        <intermediateThrowEvent id="intermediateThrowEvent" name="SignalThrowEvent">
            <signalEventDefinition signalRef="terminate"/>
        </intermediateThrowEvent>
        <intermediateThrowEvent id="intermediateThrowEvent2" name="SignalThrowEvent2">
            <signalEventDefinition signalRef="terminate2"/>
        </intermediateThrowEvent>

        <parallelGateway id="fork"/>

        <sequenceFlow sourceRef="theStart" targetRef="submit"/>

        <sequenceFlow sourceRef="submit" targetRef="fork"/>

        <sequenceFlow sourceRef="fork" targetRef="return"/>
        <sequenceFlow sourceRef="fork" targetRef="approve"/>

        <sequenceFlow sourceRef="boundary" targetRef="theEnd"/>
        <sequenceFlow sourceRef="boundaryApprove" targetRef="theEnd"/>


        <sequenceFlow sourceRef="return" targetRef="intermediateThrowEvent2"/>
        <sequenceFlow sourceRef="intermediateThrowEvent2" targetRef="theEnd"/>

        <sequenceFlow sourceRef="approve" targetRef="intermediateThrowEvent"/>
        <sequenceFlow sourceRef="intermediateThrowEvent" targetRef="theEnd"/>

    </process>
</definitions>
