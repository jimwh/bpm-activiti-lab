<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:activiti="http://activiti.org/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://www.activiti.org/test">

    <signal id="negationsFailed" name="negationsFailed"/>

    <process id="processWithSignal" name="My process" isExecutable="true">

        <startEvent id="start" name="Start"/>
        <sequenceFlow sourceRef="start" targetRef="enter"/>

        <parallelGateway id="fork"/>

        <userTask id="enter" name="Enter"/>
        <userTask id="approve" name="Approve"/>
        <userTask id="return" name="Return"/>

        <exclusiveGateway id="mergeGw"/>
        <exclusiveGateway id="MEGW"/>

        <exclusiveGateway id="exclusiveGW"/>
        <parallelGateway id="pway2" name="Parallel Gateway"/>

        <sequenceFlow sourceRef="enter" targetRef="fork"/>
        <sequenceFlow sourceRef="fork" targetRef="approve"/>
        <sequenceFlow sourceRef="fork" targetRef="return"/>

        <sequenceFlow sourceRef="approve" targetRef="exclusiveGW"/>

        <sequenceFlow sourceRef="return" targetRef="mergeGw"/>
        <boundaryEvent id="returnBoundary" name="Signal" attachedToRef="return" cancelActivity="true">
            <signalEventDefinition signalRef="negationsFailed"/>
        </boundaryEvent>
        <sequenceFlow sourceRef="returnBoundary" targetRef="mergeGw"/>

        <sequenceFlow sourceRef="exclusiveGW" targetRef="signalIntermediateThrowEvent">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RETURN}]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="exclusiveGW" targetRef="MEGW">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${!RETURN}]]></conditionExpression>
        </sequenceFlow>

        <intermediateThrowEvent id="signalIntermediateThrowEvent" name="SignalThrowEvent">
            <signalEventDefinition signalRef="negationsFailed"/>
        </intermediateThrowEvent>
        <sequenceFlow sourceRef="signalIntermediateThrowEvent" targetRef="MEGW"/>

        <sequenceFlow sourceRef="MEGW" targetRef="pway2"/>

        <sequenceFlow sourceRef="mergeGw" targetRef="pway2"/>

        <sequenceFlow sourceRef="pway2" targetRef="end"/>

        <endEvent id="end" name="End"/>

    </process>

</definitions>

